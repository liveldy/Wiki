---
title: C#
subtitle: .NET
description: C#
---

# C#

## 概览

### 什么是C\#

+ C#是一个简单的、现代的、通用的、面向对象的编程语言，它是由微软（Microsoft）开发的。
+ C#是专为公共语言基础结构（CLI）设计的。CLI由可执行代码和运行时环境组成，允许在不同的计算机平台和体系结构上使用各种高级语言。
+ 虽然C#的构想十分接近于传统高级语言C和C++，是一门面向对象的编程语言，但是它与Java非常相似，有许多强大的编程功能，因此得到广大程序员的青睐。

### C\#的特点

+ C#是.Net框架的一部分，且用于编写.Net应用程序。
+ 强大的多平台支持：C#代码在Mac、UNIX、Windows计算机上都能通过编译，也可以对在Android、iOS进行开发。

### C\#的使用

+ C#语言广泛使用在移动应用程序、桌面应用程序、Web应用程序、Web服务、游戏、虚拟现实和科学计算。

### 学习C\#

+ 如果你学过C++或者Java，你会发现学习C#会非常快速且容易，因此作者强烈建议先学习前两者语言的其中一个。
+ 作者个人认为如果出于功利角度，可以直接学C#；如果想进一步发展，建议先学习C++或者Java。

### 环境安装

C#是.Net框架的一部分，且用于编写.Net应用程序。因此，在讨论运行C#程序的可用工具之前，让我们先了解一下C#与.Net框架之间的关系。

.NET是一个免费的跨平台开放源代码开发人员平台，用于生成多种类型的应用程序。.NET可以运行使用多种语言编写的程序，其中C#是最常用的语言。此外还支持C++、Visual Basic、Jscript、COBOL等等。

.NET有多个变体，每个变体都支持不同类型的应用。 有多个变体的原因一部分是历史信息相关、一部分是技术相关。.NET实现：

+ .NET Framework -- 原始.NET。它提供对Windows和Windows Server的广泛功能的访问权限。在维护方面它得到了积极的支持。
+ Mono -- 原始社区和开放源代码.NET。 一个跨平台.NET Framework实现。 积极支持Android、iOS和WebAssembly。
+ .NET(Core) -- 新式.NET。.NET的一个跨平台开放源代码实现，已针对云时代进行了反思，同时与.NET Framework保持极大的兼容。 积极支持Linux、macOS和Windows。

!!!说明
	.NET(Core)实现是.NET5.0以及后续，.NET Framework已经被废弃，停止所有功能更新，仅保留安全支持。因此本教程以.NET8.0环境为标准。

如果你想进行Windows .NET开发，请继续往下阅读，如果你需要在其他平台开发，请移步至[Mono](https://www.mono-project.com/)。

!!!说明
	本教程以Visual Studio 2022为例进行。

环境安装的过程很简单，在微软官网安装Visual Studio，并使用Visual Studio Installer工具进行安装C#及.NET即可。如果遇到了问题，可自行在网络上查询。这里不做赘述。

## 基础语法

### 语句结构

C#在语法上和C++相差无几，接下来有关语法的说明，都是基于C++的补充和不同点。C#主要不是用于控制台程序，而是在基于.NET使用Windows窗体程序，为了方便过渡，先以控制台程序为例说明基本语法。

下面是传统的C#简单结构：

```cs
using System;
namespace ConsoleApp
{
    internal class Program
    {
        static void Main(string[] args)
        {
            Console.WriteLine("Hello, World!");
        }
    }
}
```

运行这个程序，会在控制台打印Hello, World!

但是从从.NET 6开始，新C#控制台程序可以直接使用顶级语句：

```cs
Console.WriteLine("Hello, World!");
```

运行这个程序会得到一样的结果。当然也可以使用传统的语句结构。从.NET 6开始，进行了以下改动：

1.隐式using指令

在.NET 5及其以前，程序开头都需要声明命名空间，但是从.NET 6开始，下列指令隐式地包含在程序中：

```cs
using System;
using System.IO;
using System.Collections.Generic;
using System.Linq;
using System.Net.Http;
using System.Threading;
using System.Threading.Tasks;
```

2.新的程序样式

如前文所言，可以直接不使用顶级语句，但是我们为了方便后续的学习，建议还是不使用顶级语句，即使用传统结构。在创建控制台程序项目时，将选项不使用顶级语句勾选即可。

### 基本语法

#### 数据类型与转换

+ 值类型

值类型变量可以直接分配给一个值。它们是从类 System.ValueType 中派生的。C#在一定程度上简化和拓展了C++的数据类型。

|类型|描述|范围|默认值|
|-|-|-|-|
|bool|布尔值|True或False|False|
|byte|8位无符号整数|0到255|0|
|char|16位Unicode字符|U +0000到U +ffff|'\0'|
|decimal|128位精确的十进制值，28-29 有效位数|(-7.9x10^28 到7.9x10^28 )/100到28|0.0M|
|double|64位双精度浮点型|(+/-)5.0x10^-324 到(+/-)1.7x10^308 |0.0D|
|float|32位单精度浮点型|-3.4x10^38 到+3.4x10^38 |0.0F|
|int|32位有符号整数类型|-2,147,483,648到2,147,483,647|0|
|long|64位有符号整数类型|-9,223,372,036,854,775,808到9,223,372,036,854,775,807|0L|
|sbyte|8位有符号整数类型|-128到127|0|
|short|16位有符号整数类型|-32,768到32,767|0|
|uint|32位无符号整数类型|0到4,294,967,295|0|
|ulong|64位无符号整数类型|0到18,446,744,073,709,551,615|0|
|ushort|16位无符号整数类型|0到65,535|0|

+ 引用类型

引用类型不包含存储在变量中的实际数据，但它们包含对变量的引用。引用类型包括对象（Object）类型、动态（Dynamic）类型和字符串（String）类型。字符串的值可以通过两种方式分配，一种是习以为常的`""`分配，还有一种被称为逐字字符串的`@""`的分配方式。使用这种分配的字符串不识别转义字符，并且允许多行。

+ 指针类型

C#的指针类型和C++类似。

+ 类型转换

关于类型转换，C#仍沿用了C++的隐式转换特性和转换方法。除此外，还内置了其他转换方法。即`To类型名()`函数，例如`ToByte`、`ToInt16`等。

#### 常量、变量与程序控制结构

+ 程序控制结构

C#沿用了C++的程序控制语句，并补充了foreach语句，这个语句并不鲜见，在其他语言中，例如PHP中就使用。

```cs
foreach (var item in collection)
{
    // 循环
}
```

+ 可空类型

变量、常量的特性和C++相似，这里介绍有关于此的C#独有特性。?单问号用于对int、double、bool等无法直接赋值为null的数据类型进行null的赋值，意思是这个数据类型是Nullable类型的。

```cs
int i1; //默认值0
int? i2; //默认值null
int i3 = null; //不合法
int? i4 = null; //合法
```

Null合并运算符（??）用于定义可空类型和引用类型的默认值。Null合并运算符为类型转换定义了一个预设值，以防可空类型的值为Null。Null合并运算符把操作数类型隐式转换为另一个可空（或不可空）的值类型的操作数的类型。

+ 数组类型

在定义数组时，C#的风格不同于C++，以下为C#有关数组的示例：

```cs
double[] balance; //声明数组
double[] balance = new double[10]; //初始化数组
double[] balance = { 2340.0, 4523.69, 3421.0}; //初始化数组
int [] marks = new int[5]  { 99,  98, 92, 97, 95}; //初始化数组
int [] marks = new int[]  { 99,  98, 92, 97, 95}; //初始化数组
balance[0] = 4500.0; //赋值数组元素
```

## C#窗体程序

前文说过，C#的控制台程序应用并不多，主要用于Windows窗体程序，接下来，我们进行有关说明。在VS启动窗口选择Windows窗体应用，框架选择.NET 8.0，其他项目名和项目路径自行选择编写。

!!! warning "注意"
	在启动窗口选择时要格外注意，要选择不带（.NET Framework）的Windows窗体应用，这个是原始的.NET 5.0之前的版本。

进行项目页面，应当有工具箱、主窗口、解决方案资源管理器、属性、输出五个窗口，如果有窗口缺失，可以在顶部菜单的视图选项中调出。对于新创建的项目，可以看到中间有标题为Form1的窗口，我们未来会对这个窗口进行控制和使用。这个窗口被称为主窗口（或父窗口），而其他生成的窗口称为子窗口，一般而言，主窗口的关闭意味着整个程序的关闭。

!!! 说明
	在项目>>属性中可以为程序设定图标，在打开的窗口中找到应用程序>>Win32资源>>图标中设置。

接下来介绍图形界面的两类开发方式：以设计器为主的开发和以代码为主的开发。以设计器为主的开发是指利用工具箱将控件拖拽到窗口进行调整和在属性窗口进行属性设置，然后在代码界面进行逻辑编写；而以代码为主的开发是指不使用工具箱和属性窗口，而是关于控件的操作全部都在代码中实现。这两类方法各有优劣。以设计器为主的开发亲近新手，能够快速上手，并且开发方便，但是对于一些使用了显示器缩放的计算机（尤其是笔记本电脑），程序控件会出现错位和大小变形的情况，并且，如果一个项目需要长期开发和维护，控件在窗口堆积会大大影响开发效率，从长远来看，不建议使用以设计器为主的开发。以代码为主的开发脱离了设计器，控件全靠代码实现，虽然初期较为繁杂，但是高效且易于维护和扩展，有着优良的适配性和再生性，但是较难上手。这里的教程将会使用以代码为主的开发，如果感到困难，可以前往其他教程，网络上多数教程都是以设计器为主的开发进行教学的。

在C#窗体程序中，每个控件都是一个对象，在窗口上对这些控件进行调用和逻辑处理，实现需求目的。而窗口和控件都有其属性（对应对象的成员变量）和方法（对应对象的成员函数），未来的操作都在窗口完成，我们接下来说明有关窗口的属性和方法。

程序启动时，一般首先载入的是主窗口，窗口的常用属性如下：

|属性|名称|值|说明|
|-|-|-|-|
|name|名称||即对应对象的名称，必须唯一|
|AcceptButton|接受按钮|none（默认）/按钮名称|如果设置了此按钮，则用户每次按“Enter”键都相当于“单击”该按钮。|
|AllowDrop|允许拖放|False（默认）/True|是否可以接受用户拖到它上面的数据。|
|AutoScaleMode|缩放类型|None/Font（根据字体大小缩放）/Dpi（根据显示分辨率缩放）/Inherit|控件缩放类型|
|AutoScroll|允许滚动|False（默认）/True|当控件内容大于它的可见区域时是否自动显示滚动条，为True时AutoScrollMargin（控件周围边距）和AutoScrollMinSize（滚动区域最小逻辑大小）有效|
|AutoSize|自适应|False（默认）/True|控件是否自动调整自身大小以适应其内容大小|
|AutoSizeMode|自适应模式|GrowOnly（默认）/GrowAndShrink|AutoSize为True时可用|
|BackColor|背景色||窗口背景色|
